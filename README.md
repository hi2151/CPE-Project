EverCalm Forest

 
1. 	Introduction
 
Humans are naturally very competitive, from games to sports, and even in life itself. We always want to win. 
What if winning a game required not just physical skill but also a calm, focused mind? That would be a game changer, right? This project idea harnesses our competitive spirit to promote mental wellness. By mastering the game, we can learn to control our anxiety and become more relaxed, offering a hopeful path to a healthier, more balanced life. Our project is a game in which you race to push a ball past the finish line using only your brain waves. The calmer you are, the faster the ball will go.
The game would also help us stay level-headed while putting ourselves under pressure, making the skills developed more applicable to our daily lives.

i) Motivation
Engaging participants in activities that appeal to their competitive nature transforms traditional therapy concepts into a more dynamic and engaging process. Therapeutic applications of our project include stress and anxiety management, attention and focus training, especially for patients of ADHD and ASD, and cognitive rehabilitation. It can act as a biofeedback tool that responds dynamically to a person’s mental stress state, allowing them to relax in real-time. In healthcare, it can be useful for those diagnosed with ADHD or ASD as it will help them focus for prolonged periods of time. Additionally, since the game is customizable, it can be altered based on a person’s therapeutic ability (for this, changes can be made to the velocity mapping function in the p5.js code, as you will see later). Users can also track their progress over time to see if there have been any improvements in their mental and cognitive conditions. As the project is completely non-invasive, it is ideal for patients who need cognitive rehabilitation as they may need help improving cognitive functions such as focus, attention, and memory.

ii) Background Research
EEG:
Our project uses the BIOAMP EXG PILLEEG sensor from Upside Down Labs to record brain wave patterns. 
EEG records the electrical activity generated by the brain via electrodes placed on a person’s scalp. It acts as a conductor that measures the electrical activity generated by the synchronized activity of thousands or millions of neurons (in volts). It then sends a current directly from the brain to the amplifier circuit for further modifications. The amplified data can be displayed digitally as a continuous flow of voltage values. An EEG is especially effective because it provides excellent time resolution, allowing you to detect activity even at sub-second timescales, and is one of the fastest imaging techniques available (Simms). 
The BIOAMP EXG PILL is, by default, configured for the following,
Bandpass filter: Only allows frequency within 0.5-100 Hz to pass through while attenuating frequencies outside this range.
Differential Amplification: Enhances difference between active and reference electrodes.
Impedance Matching: Adjusts input impedance. 
Analog Signal Output: Converts analog signals to digital for signal processing and analysis (Upside Down Labs)

EEG wave patterns can provide crucial insights into an individual’s alertness, relaxation, or sleep state. Each brain wave represents a different state of mind that a person is experiencing at a particular time. However, for this project, we shall restrict our scope to Alpha waves, as they are observed when people are in a relaxed state of mind.

Alpha Waves:
Frequency Range: 8 Hz to 13 Hz
Commonly related to relaxation and peacefulness (Risqiwati et al., 2024)
Highly substantial in parietal-occipital regions (Edgar et al., 2023)
More prominent in the right hemisphere than the left hemisphere  (Edgar et al., 2023)

10/20 System of Electrode Placement:
Adjacent electrodes were placed at 20% of the total distance between the two preauricular points (from right to left) of the skull, as seen in Figure 2.




  

Reference Electrode (INPT-):
This was placed at A2 (Right Mastoid), which is right behind the ear. Its function is to provide the baseline for comparison against the active electrode (Biopac Systems, Inc.).
Active Electrode (INPT +)
This was placed at Oz (occipital region). Its function is to measure the potential differences caused by brain activity (Biopac Systems, Inc.). 
Ground Electrode (GND) 
This was placed at Fp1 (Nasion region). This electrode prevents power line noise (50 Hz in the UAE) from interfering with the small biopotential signals of interest (Biopac Systems, Inc.)

This method of electrode placement was chosen because it ensures a consistent and replicable framework for EEG placement across different subjects, which is crucial for ensuring consistent and comparable results across different EEG studies (Emotiv).

iii) Problem Statements and Objectives

Problem Statement: 
Our software collects EEG signals from the player's brain activity and analyzes them to determine the velocity with which a ball is pushed to the end line in a game. 

Project Objectives: 
We focused on the following objectives to accomplish the purpose of our software: 

Collecting EEG signals
Collect real-time EEG data form players using electrodes placed in the parietal-occipital regions, as described in section 1) ii) c. 
Alpha wave extraction
From the EEG signals collected, only Alpha wave signals (8-13 Hz) are extracted using the Discrete Fourier Transform in Arduino IDE software.
Determining the strength of alpha wave signals
To determine the strength of alpha wave signals, compute the magnitude of the frequency of the alpha waves. A higher magnitude of frequency implies greater strength of the alpha waves.
Integrating processed data with the game
Map data of the magnitude of the frequency of alpha waves into the velocity of the ball in p5.js software. A high magnitude of frequency should result in a greater velocity of the ball.
Developing the game interface
Develop the game interface using Procreate, including the ball, runway and the background. Also, develop the fonts to write comments such as ‘Evercalm Forest’ (title screen) and ‘The End’ (end screen). 


2. 	Project Development
 
Hardware: BIOAMP EXG PILL form Upside Down Labs, Arduino UNO
Software: Arduino IDE, p5.js, Procreate

One of the softwares used in this project was the Arduino IDE as we used an Arduino Uno to read the raw data from the EEG sensor. The aim of the Arduino code was to collect data from a sensor, analyze the brainwave frequency of the received data, and only output the alpha-band frequencies (8–13 Hz). In order to get the brainwave frequency, we had to use Fourier Transform. The Fourier Transform is a fundamental mathematical technique to decompose complex signals into their constituent frequencies (Bahri and Karim). In other words, it can break a signal into its frequency components. In our project, we used Discrete Fourier Transform (DFT) for three main reasons. First, DFT is ideal for handling finite, discrete numbers of samples. Second, it is much less computationally taxing as it is easier to implement as usable for small datasets, such as ours. Third, it allows us to easily sort the frequencies into bins that we can choose to use, such as those within the alpha band (8–13 Hz), or bins we discard. (Our code is uploaded here) 

The “SAMPLES” is the number of samples the Arduino receives before calculating the frequency using the Fourier transform. We set the number of samples to 128 because it is more efficient to calculate the Fourier transformations when the number of samples is a power of 2 because it is more efficient to calculate the Fourier transformations.

The “SAMPLING FREQUENCY” was set as a constant that was easily divisible by two because we used the Nyquist theorem. This theorem states that to accurately reconstruct a bandlimited signal, the sampling rate must be at least twice the signal’s highest frequency component (Landau). The data collection aimed to read the 128 sample values at intervals determined by the SAMPLING_FREQUENCY.

Maintaining the sampling frequency was key for four essential reasons:
It was for accurate frequency reconstruction because fluctuations in frequency may lead to aliasing, which distorts the reconstructed frequencies (GeeksforGeeks).
For accurate domain analysis. Since DFT assumes the samples are taken at evenly spaced intervals, inconsistent sampling would lead to incorrect frequency bins and magnitude calculations.
The sampling rate ensures a consistent frequency resolution, allowing for precise identification of frequency bands, such as the alpha band.
The consistent sample ensures that the time-domain re-creations accurately represent the original waveforms. 

“ALPHA_LOW” and “ALPHA_HIGH” were also set as symbolic constants as they are the boundaries of the alpha wave frequency (Farnsworth). Having these boundaries set as symbolic constants allows the code to easily adapt to different wavelengths. 


The variable sensorPin is the pin number of the analog input. The array “sensorData” was created with a size of SAMPLES so that the Fourier transform would only occur once 128 samples were taken.

The program is split into data collection, Fourier analysis, and alpha band extraction. 
analogRead(sensorPin) would read the raw analog value from the sensor connected to sensorPin to collect the samples. Each raw data value would be stored in sensorData[i] = rawValue. 
delayMicroseconds (1000000 / SAMPLING_FREQUENCY) was used to ensure a consistent sampling rate. Note that for a sampling frequency of 100 Hz, such as ours, there is a delay of 10 ms (1000 µs/100 Hz).

To compute DFT, we used several loops. The outer loop calculates the frequency bins, where these frequencies range from 0 to the Nyquist frequency. The frequency line computes the frequency for the current bin, where the resolution is 100/128≈0.78 Hz per bin.


The inner loop calculates the original EEG signals’ frequency using DFT. It does this by calculating each time-domain sensorData[n] to the real and imaginary parts of sensorData[n] for each frequency k.
Note that the actual equations are: 




Next, we filtered the DFT-transformed frequencies and only processed the frequencies within the alpha band range (8–13 Hz). We included this after the DFT conclusion so that we skip all other frequencies and focus on the desired range. After this, we calculated the magnitude of the reconstructed frequencies. The calculation combined the real and imaginary parts to compute the magnitude of the frequency component. We also divided by SAMPLES to normalize the magnitude. 

Then, we output the magnitude of alpha band frequencies to the Serial Monitor to export to p5.js. Because the magnitude represents the strength of each frequency, it can be used directly in the game.



The delay is for 1 second before starting the next data collection and analysis cycle. This delay is useful for maintaining the sampling rate and not overloading the Arduino. 



Game Development

This is the link to the sketch and code of out game:
https://editor.p5js.org/fasya/sketches/9L6jpEyhL

p5.js

To develop the game, we used p5.js, an open-source Javascript library. Firstly, we had to establish a serial communication between the Arduino and p5. To do this, we included the p5 web serial library (from here)

Screen.js: Class Screen Definition

We created a class called Screen in a file called Screen.js. This class contains methods for drawing the game's different states: start state, play state, and end state. 

start() method

The prompting text is displayed in the start() method. It asks the player to press the OPTION key to select the serial port and establish serial communication. If the serial communication has been established, the method prompts the player to press ENTER.


play() method 

Within the play() method, the game will display the magnitude of frequency (from Arduino) and the velocity (mapped from the magnitude of frequency; see later parts). Next, this method prompts the player to press the SPACE key to start the game. Once the game has started, the x-position of the ball will increment by the velocity, and the ball will start moving. The method will also calculate the time using the built-in millis() function, which returns the number of milliseconds since a sketch started running and stores this in currentMillis. The method will then display the elapsed time by subtracting currentMillis by startMillis (more on this in the keyPressed() function) and stopping the timer when the ball reaches the finish line. Once the ball reaches the finish line, a congratulatory message is displayed, along with the time it takes to reach the finish line. 

end() method

The end() method prompts the player to press ENTER if they wish to restart the game.


sketch.js: Main Sketch

Initializing variables
In the main sketch, we first initialized these variables:
Where r is the diameter of the ball, vel is the ‘velocity’ of the ball (it stores the increment value of the x-position of the ball), xPos is the x-position of the ball, endPos is the x-position of the ball when it reaches the finish line, time is the time it takes for the ball to reach the finish line, fromArduino will store the data p5 will read from Arduino, and state stores the current state of the game (start, play, or end), and gameStart is a boolean value storing whether the game has started or not.

preload() function

The function preload() is a built-in function of p5. We load assets like the images of our illustrations into p5. The function ensures that every file is fully uploaded to the system and prevents lagging or incomplete images. 


Illustrations:
Aleezah created the illustrations in Procreate. The game had a forest aesthetic, as forests create a calming environment, which can remind players of the importance of being grounded in the present.



setup() function

The function setup() is a built-in function of p5. It runs once. In this function, we created an instance of the Screen class called screen.


restart() function

We then created a restart() function to call when the game ends and the player wishes to restart. This function re-initializes the state of the game to start and gameStart to false to indicate that the game has not started.


draw() function

In the main draw() function (built-in function of p5), we set the text alignment to center, size to 20pt, fill colour to a yellow colour with hex-code #​​d4b360, a stroke weight of 5pt, stroke colour of white, and text font to Times New Roman bolded. We then display the background image as well as display the ball at the current x-position of xPos.


draw[state]() functions

We created a function that calls each of the methods from the screen instance based on the current state of the game.


keyPressed() function

The keyPressed() function is a built-in p5 function that detects input from the keyboard. In this function, we check for the game state and which key has been pressed by the player. If the game is on the start state and the player presses the OPTION key, this program will call the setUpSeria() function, a function defined in the p5 web-serial library that we used from here. The setUpSerial() function will establish a serial communication between p5 and the arduino. This way, p5 will be able to read data from the arduino. If the serial connection has been established and the game is in the start state, the game state will switch to the play state when the player presses the ENTER key. 


If the game has started in the play state and the player presses the SPACE key, the value of gameStart will be true and the timer will store the current time when the timer begins.


If the game is in the play state and the player presses the ESCAPE key, the game state will switch to the end state. 


If the game is in the end state and the player presses the ENTER key, the game will call t4eh restart() function and restarts the game.


readSerial() function

The last function in the program is the readSerial() function that is defined in the p5 web serial library. This function takes in a parameter data, which reads in the data from the arduino into the variable fromArduino. This function will then map the value of the variable fromArduino from the range 0 to 5 into the new range 0 to 1 and stores this mapped value into the variable vel.


3. 	Results and Evaluation
Our project received the EEG signals and recreated them as a measurable (magnitude of the frequency) unit. Our tests established a strong correlation between the magnitude of alpha waves and the feeling of calmness. We conducted experiments under three different conditions: a control condition (sleeping), a calm condition (in a quiet, low-light environment), and a stress condition (while debugging a game). We evaluated the success using the calculated frequency magnitudes and the game, specifically the time it took for the ball to reach the end of the game platform. 

We had some difficulties when approaching this project. Our first issue was understanding how to get the frequency. In our code, we had originally sorted the bin frequencies before filling the bins, which led to inaccurate magnitude calculations. We also tried to use the original voltages we received from the EEG sensor; however, we could not because the voltages were stepped up as the Arduino Uno could not read low voltages. We decided to do more research, which was when we learned about Fourier Transforms. Once we understood which type of Fourier Transform we would use, we had to ensure we analyzed the correct frequency. 

There were also some issues with the in-game timer. We used the in-built function millis() that returns the time in milliseconds since the start of the sketch, but one major issue was that it started counting before the ball started moving. To fix this issue, we implemented a second timer, which helps in calculating the elapsed time between the start of the sketch and when the timer actually starts. 

To evaluate our program, we conducted two test trials. The video demonstrations of the two trials can be found in the following links,

Trial Test 1
Subject 1 Relaxed State: Subject1_Relaxed
Subject 1 Stressed State: Subject1_Stressed

Trial Test 2
Subject 2 Relaxed State: Subject2_Relaxed
Subject 2 Stressed State: Subject2_Stressed

We have identified two potential constraints with our project evaluation that might limit our confidence in the reliability of the experiments. First, we only conducted two test trials; therefore, more tests are needed. Additionally, longer trial periods should be used to investigate whether routinely playing the game over a longer period can help us become calmer. 

4. 	Conclusion and Future work
This section presents a summary of the project achievements and a short discussion on potential future developments.

Through our project, we achieved a number of objectives we set out to achieve. In our project, we were able to successfully collect real-time EEG data from players using electrodes placed in the parietal-occipital regions, as described previously. Additionally, from the EEG signals collected, we were able to extract alpha wave signals (8-13 Hz) using the Discrete Fourier Transform in Arduino IDE software. We successfully determined the strength of alpha wave signals by computing the magnitude of the frequency of the alpha waves. A higher magnitude of frequency implied greater strength of the alpha waves. Furthermore, we were able to integrate processed data with the game by mapping data of the magnitude of the frequency of alpha waves into the velocity of the ball in p5.js software. A high magnitude of frequency resulted in a greater velocity of the ball. Finally, we successfully developed the game interface using Procreate, including the ball, runway and the background. We developed the fonts to write comments such as ‘Evercalm Forest’ (title screen) and ‘The End’ (end screen).
 
One potential future development for our project is its integration with other physiological data points to get a more accurate estimate of the state of a person. Presently, our project only uses a single modality (the EEG) so the accuracy of stress detection is limited. In the future, we can integrate an ECG device (on top of our current project) to measure the electrical activity of the heart, with lower Heart Rate Variability indicating higher stress levels. Additionally respiratory sensors, blood pressure sensors and blood glucose monitors could be used together with the EEG device so that our project can provide more sound estimates of the stress level of users, and therefore, more enhanced biofeedback. In the future, we can also look into the potential of creating portable and wearable devices that display the game so that users can regularly track their mental state anywhere and at any time of the day. Another future development for our project is to see if we can play the game repeatedly to train ourselves to be calmer. This could be implemented for example by asking the user to perform a series of different actions that require different levels of cognitive stress, such as yoga (low stress level), solving a puzzle (medium stress level) and performing in front of an audience (high stress level). By controlling the stress level across a gradient, we can see if it is possible to consciously calm ourselves down. If players participate in this game daily, they will eventually be able to improve their management of stress. We are confident that with these future developments integrated into our current project, our project can pioneer breakthroughs in mental and cognitive health monitoring.

5. 	Reflection on Learning
 
This section summarizes the learning outcome of this project (what you have learned as you developed this project).

Significance of electrode placement, specifically understanding where alpha waves are most prominently emitted
How the three different electrodes from the Bioamp EXG Pill function, and the reasoning behind their specific placements. 
Learnt alpha-band filtering using DFT
Significance of computing the strength of alpha waves by determining the magnitude of frequency of the alpha waves
How to establish a serial communication between arduino and p5 
How to map raw data values into velocity values in p5.
How to create a timer using the millis() function in p5.

6. 	Bibliography

BioAmp EXG Pill. Upside Down Labs, https://store.upsidedownlabs.tech/product/bioamp-exg-pill/ Accessed 5 Dec. 2024.
Edgar, J. C.,  et al. “A comparison of resting-state eyes-closed and dark-room alpha-band activity in children.” Psychophysiology vol. 60,6 (2023): e14285. doi:10.1111/psyp.14285
Emotiv. "Understanding the 10-20 System of EEG Electrode Placement." Emotiv, https://understanding-the-10-20-system-of-eeg-electrode-placement. Accessed 9 Dec. 2024.
GeeksforGeeks. “Aliasing Effect.” GeeksforGeeks, 20 Mar. 2024, www.geeksforgeeks.org/aliasing-effect/. Accessed 9 Dec. 2024.

Risqiwati, D., et al. "Effective Relax Acquisition: A Novel Approach to Classify Relaxed State in Alpha Band EEG-Based Transformation." Brain Informatics, vol. 11, no. 12, 2024, https://doi.org/10.1186/s40708-024-00225-y.
Simms, Andrew Paul. "Reading and Wirelessly Sending EEG Signals Using Arduinos and XBee Radios to Control a Robot." ScholarWorks@UARK, 2014, https://scholarworks.uark.edu/cgi/1027.
Sketchfab. 10/20 System of Electrode Placement. 2021, Sketchfab, https://skfb.ly/oq89Z.
Biopac Systems, Inc. "Ground vs. Reference for EEG Recording." Biopac, https://www.biopac.com/knowledge-base/ground-vs-reference-for-eeg-recording/. Accessed 5 Dec. 2024.
